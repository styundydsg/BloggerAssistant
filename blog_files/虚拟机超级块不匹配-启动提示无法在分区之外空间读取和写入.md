---
title: 虚拟机Linux超级块不匹配/启动提示无法在分区之外空间读取和写入
date: 2025-05-14 16:07:10
tags: 解决方案
categories: Linux
---

##### 注意
过程我有些记不清了，可以先看链接处理，主要是后面要进入parted模式  
第一次no然后后面的就是yes那里不出意外很快的，我有一次按了很久的y都没成功，虽然不知道有没有影响  
然后操作里会有选择start、end就将大小改回来就可以了  
下面不保证操作顺序的正确  
可以问问ai那些命令是什么意思判断调整顺序  

["Either the superblock or the partition table is likely to be corrupt!" after partition resized](https://unix.stackexchange.com/questions/565923/either-the-superblock-or-the-partition-table-is-likely-to-be-corrupt-after-pa)

1. 
    首先下载与你损坏虚拟机版本相同的iso文件，将损坏虚拟机的cd改为该iso，启动后try ... install进入，即可使用命令行操作

2. 
    ```Shell
    sudo fdisk -l /dev/whatever 比如/dev/sda（还是sda2了）
    ```

3. 
    将结果抄在纸上。然后修复分区表：
    ```Shell
    sudo fdisk /dev/whatever
    ```

4. 
    ```Shell
    sudo fdisk /dev/sdX  # 替换为你的磁盘设备，如 /dev/sda
    ```
<!-- more -->

5. 
    ##### 删除旧分区
    输入 p 查看当前分区表，确认要删除的分区号。

    输入 d 删除分区。

    选择要删除的分区号（例如输入 1 删除第一个分区）。

    重复上述步骤删除所有需要移除的分区。

    输入 p 再次确认分区表已清空。



6. 

    ##### 创建新分区
    输入 n 新建分区。

    选择分区类型：

    p：主分区（MBR 磁盘最多 4 个主分区）。

    e：扩展分区（用于创建逻辑分区）。

    设置分区号（默认自动分配，按回车跳过）。

    设置起始扇区（通常使用默认值，直接回车）。

    设置结束扇区或分区大小：

    直接回车：使用全部剩余空间。

    指定大小（如 +20G 表示分配 20GB）。

7. 
    输入 p 最终确认分区表无误。

    输入 w 保存并退出。（此操作不可逆！）

8. 
    文件系统检查
    ```Shell
    sudo fdisk /dev/whatever
    ```

9. 
    ```Shell
    sudo parted /dev/sda
    (parted) print          # 查看当前分区表，确认 `/dev/sda2` 的编号（此处应为分区2）
    (parted) resizepart 2   # 选择要调整的分区编号（这里是2）
    新的结束点？ [20GB]? 100%  # 输入 100%（直接覆盖全部剩余空间）
    (parted) quit           # 退出
    ```
10. 
    ```Shell
    sudo partprobe /dev/sda  # 重新加载分区表
    ```
    
11. 
    ```Shell
    df -Th | grep /dev/sda2
    ```
    若为 ext4：
    ```Shell
    sudo resize2fs /dev/sda2
    ```

12. 
    ```Shell
    lsblk    # 确认 `/dev/sda2` 的 SIZE 变为 30G
    df -h    # 查看 `/` 分区的可用空间是否增加
    ```


13. 
    然后就可以将挂载了
    可以看到文件之后解除挂载
    关闭虚拟机在编辑里不用那个iso后选择自动检测重启，不出意外可以进入
    